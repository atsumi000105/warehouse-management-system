build-job:
    image: node:12
    script:
        - yarn build

test-js:
    stage: test
    image: node:12
    cache:
        paths:
            - node_modules/
    script:
        - pwd
        - ls
        - yarn lint
        - yarn test

test-php:
    stage: test
    image: php:7.3
    before_script:
        - pwd
        - ls
        - bash ci/docker_install.sh > /dev/null
        - composer self-update --2
        - composer install --prefer-source --no-interaction
        - psql -c 'create database coverd;' -U postgres
        - bin/console doctrine:schema:update --force
    cache:
        paths:
            - $HOME/.composer/cache/files
            - $COMPOSER_BIN_DIR/.phpunit
            - vendor/
    variables:
        SYMFONY_PHPUNIT_DIR: "$COMPOSER_BIN_DIR/.phpunit"
    script:
        - bin/console doctrine:schema:validate
        - bin/phpunit -v --coverage-clover clover.xml
        - vendor/bin/phpstan analyse --debug
        - vendor/bin/phpcs








#matrix:
#    include:
#          cache:
#              yarn: true
#          before_install:
#              - curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64 > ./cc-test-reporter
#              - chmod +x ./cc-test-reporter
#              - ./cc-test-reporter before-build
#          before_script:
#              - composer self-update --2
#              - composer install --prefer-source --no-interaction
#              - psql -c 'create database coverd;' -U postgres
#              - bin/console doctrine:schema:update --force
#          script:
#              - bin/console doctrine:schema:validate
#              - bin/phpunit -v --coverage-clover clover.xml
#              - vendor/bin/phpstan analyse --debug
#              - vendor/bin/phpcs
#          after_script:
#              - ./cc-test-reporter format-coverage -t clover # Backend coverage
#              - if [[ "$TRAVIS_TEST_RESULT" == 0 ]]; then ./cc-test-reporter upload-coverage; fi  # Upload coverage/codeclimate.json
#    fast_finish: true
#    allow_failures:
#        - php: nightly
#notifications:
#    email: false
#services:
#    - postgresql